name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
      - master  # Adding both main and master branch triggers

# Workflow to deploy the website and generate config.js with secrets
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Debug Info
        run: |
          echo "Current directory contents:"
          ls -la
          echo "Branch name:"
          git branch --show-current
          echo "Git status:"
          git status

      - name: Create Config File
        run: |
          mkdir -p js
          echo "Creating config.js file..."
          cat > js/config.js << EOF
          // Configuration file generated by GitHub Actions
          const config = {
            // Telegram Bot Configuration
            telegram: {
              botToken: "${{ secrets.TELEGRAM_BOT_TOKEN }}",
              chatId: "${{ secrets.TELEGRAM_CHAT_ID }}"
            },
            
            // Google Apps Script API Endpoints
            api: {
              // Add other API endpoints here as needed
            }
          };

          // Export the configuration
          if (typeof module !== 'undefined' && module.exports) {
            module.exports = config;
          } else {
            // For browser environment
            window.config = config;
          }
          EOF
          echo "Config file created. Contents of js directory:"
          ls -la js/
          echo "First few lines of config.js (without sensitive data):"
          head -n 5 js/config.js

      - name: List Files Before Deploy
        run: |
          echo "Contents of repository before deploy:"
          ls -la
          echo "Contents of js directory:"
          ls -la js/

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: . # The folder the action should deploy.
          branch: gh-pages # The branch the action should deploy to.
          token: ${{ secrets.GITHUB_TOKEN }}  # Using GITHUB_TOKEN for authentication

      - name: Verify Deployment
        run: |
          echo "Deployment completed. Check the gh-pages branch for the deployed files." 