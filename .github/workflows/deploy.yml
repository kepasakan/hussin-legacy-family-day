name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # or master, depending on your default branch name

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Debug Info
        run: |
          echo "Current directory contents:"
          ls -la
          echo "Branch name:"
          git branch --show-current

      - name: Create Config File
        run: |
          mkdir -p js
          echo "Creating config.js file..."
          cat > js/config.js << EOF
          // Configuration file generated by GitHub Actions
          const config = {
            // Telegram Bot Configuration
            telegram: {
              botToken: "${{ secrets.TELEGRAM_BOT_TOKEN }}",
              chatId: "${{ secrets.TELEGRAM_CHAT_ID }}"
            },
            
            // Google Apps Script API Endpoints
            api: {
              // Add other API endpoints here as needed
            }
          };

          // Export the configuration
          if (typeof module !== 'undefined' && module.exports) {
            module.exports = config;
          } else {
            // For browser environment
            window.config = config;
          }
          EOF
          echo "Config file created. Contents of js directory:"
          ls -la js/
          echo "First few lines of config.js (without sensitive data):"
          head -n 5 js/config.js

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: . # The folder the action should deploy.
          branch: gh-pages # The branch the action should deploy to. 