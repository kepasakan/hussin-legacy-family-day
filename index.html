<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Day 2025</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- NOTE: Header - Tajuk utama Family Day dan countdown -->
  <header>
    <h1>ğŸ‰ Family Day 2025</h1>
    <p>Bersama Kita Bahagia | 15-17 Mac 2025</p>
    <div id="countdown" style="font-size: 1.5rem; margin-top: 10px;"></div>
  </header>

  

  <!-- NOTE: Menu navigasi ke bahagian lain (future plan) -->
  <nav>
    <a href="index.html">Home</a>
    <a href="aturcara.html">Aturcara</a>
    <a href="bayaran.html">Bayaran</a>
    <a href="kehadiran.html">Kehadiran</a>
    <a href="#">Kenangan</a>
  </nav>

  <main>

    <!-- NOTE: Info penting tentang lokasi, tarikh, penginapan -->
    <section>
      <h2>ğŸ“Œ Info Penting</h2>
      <ul>
        <li>Lokasi: Port Dickson, Negeri Sembilan</li>
        <li>Tarikh: 15 - 17 Mac 2025</li>
        <li>Tempat penginapan: Homestay tepi pantai</li>
      </ul>
    </section>

    <!-- NOTE: Senarai kutipan bayaran (static/dummy display) -->
    <section>
      <h2>ğŸ“‹ Senarai Kutipan</h2>
    
      <!-- âœ… Info kutipan total -->
      <div class="total-info">
        <p><strong>Jumlah diperlukan:</strong> RM2000</p>
        <p><strong>Jumlah terkumpul:</strong> RM<span id="jumlahTerkumpul">0</span></p>
        <p><strong>Baki:</strong> RM<span id="bakiKutipan">0</span></p>
    
        <!-- âœ… Progress bar auto-update -->
        <div class="progress-container">
          <div id="overallProgress" class="progress-bar" style="width: 0%; background-color: #2196f3;">0%</div>
        </div>
      </div>
    </section>


    <!-- NOTE: Semakan status bayar berdasarkan kata kunci -->
    <section>
      <h2>ğŸ” Semak Status Bayaran Anda</h2>
      <p>Masukkan kata kunci khas keluarga anda untuk semak status kutipan.</p>

      <!-- Input untuk kata kunci family -->
      <input type="password" id="accessKey" placeholder="Contoh: fam1husin" />
      <button onclick="checkPayment()">Semak</button>

      <!-- NOTE: Spinner loading semasa data sedang dimuat -->
      <div id="loading" style="display: none; text-align: center; margin-top: 1rem;">
        <div style="display: inline-flex; align-items: center; gap: 10px;">
          <!-- Animated SVG spinner -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
            <circle cx="50" cy="50" fill="none" stroke="#f59e0b" stroke-width="10" r="35" stroke-dasharray="164.9 56.9">
              <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"/>
            </circle>
          </svg>
          <span style="font-weight: bold; color: #f59e0b;">Memuatkan maklumat...</span>
        </div>
      </div>

      <!-- NOTE: Tempat result akan dipaparkan selepas semakan -->
      <div id="result" style="margin-top: 1rem; font-weight: bold;"></div>
    </section>

    <!-- NOTE: Link ke Google Form pengesahan kehadiran -->
    <section>
      <h2>ğŸ“ Kehadiran</h2>
      <p>Sila sahkan kehadiran anda melalui <a href="https://forms.gle/your-form-link" target="_blank">borang ini</a>.</p>
    </section>

  </main>

  <!-- NOTE: Footer website -->
  <footer>
    <p>Â© 2025 Family Day Team | Bendahari: Nama Anda</p>
  </footer>

  <!-- NOTE: Countdown timer ke tarikh Family Day -->
  <script>
    const countDownDate = new Date("May 1, 2025 08:00:00").getTime();

    const countdown = setInterval(function () {
      const now = new Date().getTime();
      const distance = countDownDate - now;

      if (distance < 0) {
        clearInterval(countdown);
        document.getElementById("countdown").innerHTML = "ğŸ‰ Family Day bermula!";
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      document.getElementById("countdown").innerHTML =
        `â³ Tinggal ${days} hari ${hours} jam ${minutes} minit ${seconds} saat`;
    }, 1000);
  </script>

  <!-- NOTE: Function semak status bayaran ikut kata kunci -->
  
  <script>
  // =============================================
  // âœ… FUNCTION: SEMAK STATUS KATA KUNCI (Sheet1)
  // =============================================
  async function checkPayment() {
    const key = document.getElementById("accessKey").value.toLowerCase();
    const resultDiv = document.getElementById("result");
    const loadingDiv = document.getElementById("loading"); // loading spinner element
  
    resultDiv.innerHTML = ""; // kosongkan result sebelum fetch
    loadingDiv.style.display = "block"; // tunjuk spinner
  
    const url = `https://script.google.com/macros/s/AKfycbw5899UUEP5g3so6vn_DkMA7s2ou2EHNd_UY0pmFYge23Ka1jdMxHsI9qWAsbBSAP6cHA/exec?key=${key}`;
  
    try {
      const response = await fetch(url);
      const text = await response.text();
      console.log("ğŸ” Raw Response:", text); // debug log
  
      const data = JSON.parse(text);
      loadingDiv.style.display = "none"; // hide spinner
  
      if (data.status === "error") {
        resultDiv.innerHTML = "âŒ Kata kunci tidak sah.";
        return;
      }
  
      const percent = Math.round((data.bayar / data.perlu) * 100);
      let barColor = "#f44336";
      if (percent === 100) barColor = "#4CAF50";
      else if (percent >= 50) barColor = "#FF9800";
  
      resultDiv.innerHTML = `
        <div style="font-size:1.2rem; color:#b71c1c;">ğŸ¡ <strong>${data.nama}</strong></div>
        ğŸ’° <span style="color:#f57c00;"><strong>Jumlah perlu bayar:</strong> RM${data.perlu}</span><br>
        âœ… <span style="color:#388e3c;"><strong>Sudah bayar:</strong> RM${data.bayar}</span><br>
        ğŸ§¾ <strong>Baki:</strong> RM${data.perlu - data.bayar}
        <div class="progress-container">
          <div class="progress-bar" style="width:${percent}%; background-color:${barColor}; transition: width 1s ease-in-out;">${percent}%</div>
        </div>
      `;
    } catch (error) {
      loadingDiv.style.display = "none";
      resultDiv.innerHTML = "âŒ Gagal semak data.";
      console.error("Error:", error);
    }
  }
  
  
  // ========================================================
  // âœ… FUNCTION: TOTAL KUTIPAN Sheet1 + Sheet2 (auto onload)
  // ========================================================
  async function kiraKutipanAutomatik() {
    const url = "https://script.google.com/macros/s/AKfycbyAYkTIVoWtirHtKWUDJOlkDXH0WkSNzuiwesrwtmCNCY3M_dLiZ8oDqQCeOpX628C1KA/exec";
  
    try {
      const response = await fetch(url);
      const data = await response.json();
  
      if (data.status === "success") {
        const target = 2000;
        const terkumpul = data.total_jumlah; // â† pakai dari API
        const baki = target - terkumpul;
        const percent = Math.min(Math.round((terkumpul / target) * 100), 100);
  
        document.getElementById("jumlahTerkumpul").textContent = terkumpul;
        document.getElementById("bakiKutipan").textContent = baki <= 0 ? 0 : baki;
  
        const bar = document.getElementById("overallProgress");
        bar.style.width = percent + "%";
        bar.textContent = percent + "%";
      }
    } catch (err) {
      console.error("âŒ Gagal tarik data kutipan:", err);
    }
  }

  
  // ========================================================
  // âœ… AUTO-RUN: Bila page dibuka, auto load kutipan bar
  // ========================================================
  window.onload = function () {
    kiraKutipanAutomatik();
  };
  </script>


</body>
</html>
